# API Weekly Summary - Changelog for Frontend

## ğŸ“‹ Tá»•ng Quan

ÄÃ£ táº¡o API má»›i Ä‘á»ƒ **giáº£m 751 API calls xuá»‘ng cÃ²n 1 call** cho trang Attendance Week View.

---

## ğŸ”´ CÅ¨: 3 Táº§ng API (751 calls)

### BÆ°á»›c 1: Láº¥y danh sÃ¡ch nhÃ¢n viÃªn
```
GET /api/v1/employees/active
```
**Sá»‘ láº§n gá»i:** 1 call

---

### BÆ°á»›c 2: Láº¥y lá»‹ch lÃ m viá»‡c tá»«ng nhÃ¢n viÃªn  
```
GET /api/v1/work-schedules/employee/{employeeId}/date-range?startDate=2025-12-23&endDate=2025-12-29
```
**Sá»‘ láº§n gá»i:** N calls (50 nhÃ¢n viÃªn = 50 calls)

---

### BÆ°á»›c 3: Láº¥y attendance tá»«ng work schedule
```
GET /api/v1/attendances/my/{workScheduleId}?employeeId={employeeId}
```
**Sá»‘ láº§n gá»i:** N Ã— M calls (50 nhÃ¢n viÃªn Ã— 14 schedules = 700 calls)

**Tá»”NG:** 1 + 50 + 700 = **751 API calls** âŒ

---

## ğŸŸ¢ Má»šI: 1 API Duy Nháº¥t (1 call)

### Endpoint
```
GET /api/v2/attendances/weekly-summary?startDate=2025-12-23&endDate=2025-12-29
```

### Request Parameters
| Param | Type | Required | Format | Example |
|-------|------|----------|--------|---------|
| `startDate` | LocalDate | âœ… Yes | YYYY-MM-DD | 2025-12-23 |
| `endDate` | LocalDate | âœ… Yes | YYYY-MM-DD | 2025-12-29 |

---

### Response Structure

```json
{
  "startDate": "2025-12-23",
  "endDate": "2025-12-29",
  "employees": [
    {
      "employee": {
        "id": 1,
        "fullname": "Nguyá»…n VÄƒn A",
        "email": "a@gmail.com",
        "department": null
      },
      "statistics": {
        "totalScheduled": 14,
        "worked": {
          "count": 12,
          "totalHours": 48
        },
        "absent": {
          "count": 2,
          "totalHours": 8
        },
        "late": {
          "count": 3,
          "totalMinutes": 25
        },
        "earlyLeave": {
          "count": 1,
          "totalMinutes": 15
        },
        "overtime": {
          "count": 5,
          "totalMinutes": 120
        }
      }
    }
  ]
}
```

---

## ğŸ“Š Response Model Chi Tiáº¿t

### ResWeeklySummary (Root Object)
```typescript
interface ResWeeklySummary {
  startDate: string;        // YYYY-MM-DD
  endDate: string;          // YYYY-MM-DD
  employees: EmployeeSummary[];
}
```

### EmployeeSummary
```typescript
interface EmployeeSummary {
  employee: Employee;
  statistics: Statistics;
}
```

### Employee
```typescript
interface Employee {
  id: number;
  fullname: string;
  email: string;
  department: string | null;  // TODO: ChÆ°a cÃ³ trong database
}
```

### Statistics
```typescript
interface Statistics {
  totalScheduled: number;     // Tá»•ng sá»‘ ca Ä‘Æ°á»£c phÃ¢n cÃ´ng
  worked: WorkedStats;
  absent: AbsentStats;
  late: LateStats;
  earlyLeave: EarlyLeaveStats;
  overtime: OvertimeStats;
}
```

### WorkedStats
```typescript
interface WorkedStats {
  count: number;        // Sá»‘ ca Ä‘Ã£ cháº¥m cÃ´ng
  totalHours: number;   // Tá»•ng sá»‘ giá» lÃ m viá»‡c (phÃºt Ã· 60)
}
```

### AbsentStats
```typescript
interface AbsentStats {
  count: number;        // Sá»‘ ca váº¯ng
  totalHours: number;   // Tá»•ng sá»‘ giá» váº¯ng (dá»±a vÃ o standardHours cá»§a shift)
}
```

### LateStats
```typescript
interface LateStats {
  count: number;          // Sá»‘ láº§n Ä‘i muá»™n
  totalMinutes: number;   // Tá»•ng sá»‘ phÃºt Ä‘i muá»™n
}
```

### EarlyLeaveStats
```typescript
interface EarlyLeaveStats {
  count: number;          // Sá»‘ láº§n vá» sá»›m
  totalMinutes: number;   // Tá»•ng sá»‘ phÃºt vá» sá»›m
}
```

### OvertimeStats
```typescript
interface OvertimeStats {
  count: number;          // Sá»‘ láº§n lÃ m thÃªm giá»
  totalMinutes: number;   // Tá»•ng sá»‘ phÃºt lÃ m thÃªm
}
```

---

## âœ… Lá»£i Ãch

| Metric | CÅ© (3 APIs) | Má»›i (1 API) | Cáº£i Thiá»‡n |
|--------|-------------|-------------|-----------|
| **API Calls** | 751 calls | 1 call | â¬‡ï¸ 99.87% |
| **Thá»i gian load** | 10-15 giÃ¢y | 200-500ms | â¬‡ï¸ 95%+ |
| **SQL Queries** | N/A | 3 queries | Tá»‘i Æ°u |
| **Network Bandwidth** | Cao | Tháº¥p | â¬‡ï¸ ÄÃ¡ng ká»ƒ |

---

## ğŸ“ Notes

### Äiá»ƒm KhÃ¡c Biá»‡t Quan Trá»ng

1. **totalHours vs totalMinutes:**
   - `worked.totalHours`: ÄÃ£ chia cho 60 (phÃºt â†’ giá»)
   - `late.totalMinutes`, `earlyLeave.totalMinutes`, `overtime.totalMinutes`: Váº«n tÃ­nh báº±ng PHÃšT

2. **Absent Calculation:**
   - Dá»±a trÃªn `workSchedule` KHÃ”NG cÃ³ attendance
   - `absentHours` = Tá»•ng `standardHours` cá»§a cÃ¡c shift bá»‹ váº¯ng

3. **Department Field:**
   - Hiá»‡n táº¡i tráº£ vá» `null` vÃ¬ chÆ°a cÃ³ trong Employee entity
   - TODO: Sáº½ cáº­p nháº­t sau khi thÃªm Department entity

4. **Only Active Employees:**
   - API chá»‰ tráº£ vá» nhÃ¢n viÃªn cÃ³ `status = ACTIVE`
   - KhÃ´ng bao gá»“m nhÃ¢n viÃªn Ä‘Ã£ nghá»‰ viá»‡c/inactive
